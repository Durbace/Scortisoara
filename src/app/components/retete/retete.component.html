<button
  class="back-btn"
  type="button"
  (click)="onBack()"
  [attr.aria-label]="(labels$ | async)?.back"
>
  <svg
    class="back-btn__icon"
    viewBox="0 0 24 24"
    width="20"
    height="20"
    aria-hidden="true"
  >
    <path
      fill="currentColor"
      d="M15.5 19a1 1 0 0 1-.7-.3l-7-7a1 1 0 0 1 0-1.4l7-7a1 1 0 1 1 1.4 1.4L10.41 11l5.79 5.3a1 1 0 0 1-.7 1.7Z"
    />
  </svg>
  <span class="back-btn__label">{{ (labels$ | async)?.back }}</span>
</button>

<ng-container *ngIf="recipes$ | async as recipes; else loading">
  <section
    class="retete__section"
    *ngFor="let r of recipes; let i = index"
    [class.crem]="i % 2 === 1"
  >
    <div class="retete__inner">
      <article class="feature-card" [class.feature-card--reverse]="i % 2 === 1">
        <div class="feature-card__media">
          <img [src]="r.img" [alt]="r.title" />
          <span class="feature-card__badge">{{
            (labels$ | async)?.badge
          }}</span>
        </div>

        <div class="feature-card__content">
          <h2 class="feature-card__title">{{ r.title }}</h2>
          <p class="feature-card__text">{{ r.excerpt }}</p>

          <button
            class="btn btn--outline"
            type="button"
            (click)="selectRecipe(r)"
            data-bs-toggle="modal"
            data-bs-target="#recipeModal"
          >
            {{ (labels$ | async)?.seeRecipe }} <span aria-hidden="true">→</span>
          </button>
        </div>
      </article>
    </div>
  </section>

  <div
    class="modal fade"
    id="recipeModal"
    tabindex="-1"
    aria-labelledby="recipeModalLabel"
    aria-hidden="true"
    (hidden.bs.modal)="clearRecipe()"
  >
    <div
      class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="recipeModalLabel">
            {{ activeRecipe?.title }}
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>

        <div class="modal-body">
          <div class="mb-3 d-flex flex-wrap gap-3" *ngIf="activeRecipe as ar">
            <span *ngIf="ar.prep"
              ><strong>{{ (labels$ | async)?.prep }}:</strong>
              {{ ar.prep }}</span
            >
            <span *ngIf="ar.cook"
              ><strong>{{ (labels$ | async)?.cook }}:</strong>
              {{ ar.cook }}</span
            >
            <span *ngIf="ar.servings"
              ><strong>{{ (labels$ | async)?.servings }}:</strong>
              {{ ar.servings }}</span
            >
          </div>

          <div class="row g-4 align-items-start" *ngIf="activeRecipe as ar">
            <div class="col-12 col-lg-5 col-xl-4">
              <div class="img-wrap mx-auto">
                <div class="ratio ratio-1x1">
                  <img
                    class="w-100 h-100 rounded-4 shadow object-fit-cover"
                    [src]="ar.img"
                    [alt]="ar.title"
                  />
                </div>
              </div>
            </div>

            <div class="col-12 col-lg-7 col-xl-8">
              <h4 class="fw-bold mb-2">{{ (labels$ | async)?.ingredients }}</h4>
              <ul class="modal__list">
                <li *ngFor="let ing of ar.ingredients">{{ ing }}</li>
              </ul>

              <h4 class="fw-bold mt-3 mb-2">{{ (labels$ | async)?.steps }}</h4>
              <ol class="modal__list">
                <li *ngFor="let step of ar.steps">{{ step }}</li>
              </ol>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-maro" data-bs-dismiss="modal">
            {{ (labels$ | async)?.back }}
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <p style="padding: 1rem; opacity: 0.7">…</p>
</ng-template>
